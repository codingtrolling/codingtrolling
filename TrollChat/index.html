<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrollChat | codingtrolling.com</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --sidebar-dark: #1E1F22;
            --main-dark: #2B2D31;
            --chat-bg: #313338;
            --text-white: #F2F3F5;
            --text-muted: #949BA4;
            --discord-blurple: #5865F2;
            --online-green: #23A55A;
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background: var(--main-dark); color: var(--text-white); overflow: hidden; }

        /* --- THE GRID LAYOUT --- */
        .app-layout {
            display: grid;
            grid-template-columns: 72px 240px 1fr 240px;
            height: 100vh;
        }

        /* 1. SERVER BAR */
        .server-bar { background: var(--sidebar-dark); display: flex; flex-direction: column; align-items: center; padding-top: 12px; gap: 8px; }
        .server-icon { width: 48px; height: 48px; background: var(--chat-bg); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .server-icon:hover { border-radius: 30%; background: var(--discord-blurple); }

        /* 2. CHANNEL LIST */
        .channel-list { background: var(--main-dark); padding: 10px; display: flex; flex-direction: column; }
        .channel-item { padding: 8px; border-radius: 4px; color: var(--text-muted); cursor: pointer; margin-bottom: 2px; }
        .channel-item:hover { background: #35373c; color: var(--text-white); }
        .channel-item.active { background: #3f4147; color: var(--text-white); }

        /* 3. CHAT AREA */
        .chat-container { background: var(--chat-bg); display: flex; flex-direction: column; }
        .chat-header { height: 48px; border-bottom: 1px solid #26272b; display: flex; align-items: center; padding: 0 16px; font-weight: bold; }
        #message-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .message { display: flex; gap: 15px; }
        .message img { width: 40px; height: 40px; border-radius: 50%; }
        .msg-content b { color: var(--text-white); margin-right: 8px; }
        .msg-content p { margin: 4px 0 0 0; color: #DBDEE1; }

        /* INPUT AREA */
        .input-box { padding: 0 16px 24px 16px; }
        .input-wrapper { background: #383A40; border-radius: 8px; padding: 10px; display: flex; }
        #msg-input { background: transparent; border: none; color: white; flex: 1; outline: none; font-size: 16px; }

        /* 4. MEMBER LIST */
        .member-list { background: var(--main-dark); padding: 20px 10px; }
        .user-row { display: flex; align-items: center; gap: 10px; padding: 6px; cursor: pointer; }
        .status-dot { width: 10px; height: 10px; background: var(--online-green); border-radius: 50%; border: 2px solid var(--main-dark); }

        /* MOBILE ADJUSTMENTS */
        @media (max-width: 800px) {
            .app-layout { grid-template-columns: 72px 1fr; }
            .member-list, .channel-list { display: none; } /* Hide sidebars on phone */
        }
    </style>
</head>
<body>

<div class="app-layout">
    <div class="server-bar">
        <div class="server-icon" style="background: var(--discord-blurple);"><i class="fa fa-robot"></i></div>
        <hr style="width: 32px; border: 1px solid #35373c;">
        <div class="server-icon"><i class="fa fa-skull"></i></div>
    </div>

    <div class="channel-list">
        <h3 style="font-size: 12px; color: var(--text-muted); text-transform: uppercase;">Text Channels</h3>
        <div class="channel-item active"># general</div>
        <div class="channel-item"># coding-help</div>
        <div class="channel-item"># troll-leaks</div>
    </div>

    <div class="chat-container">
        <div class="chat-header"><i class="fa fa-hashtag" style="color: var(--text-muted); margin-right: 8px;"></i> general</div>
        <div id="message-area">
            </div>
        <div class="input-box">
            <div class="input-wrapper">
                <input type="text" id="msg-input" placeholder="Message #general">
            </div>
        </div>
    </div>

    <div class="member-list">
        <h3 style="font-size: 12px; color: var(--text-muted); text-transform: uppercase;">Online â€” <span id="user-count">0</span></h3>
        <div id="member-area"></div>
    </div>
</div>

<script>
    const socket = io("https://trollchat-backend-production.up.railway.app");
    const msgInput = document.getElementById('msg-input');
    const msgArea = document.getElementById('message-area');

    let me = {
        name: prompt("Username?") || "Troll_" + Math.floor(Math.random()*100),
        avatar: "https://api.dicebear.com/7.x/pixel-art/svg?seed=" + Math.random()
    };

    socket.emit('join', me);

    // SEND MESSAGE
    msgInput.addEventListener('keypress', (e) => {
        if(e.key === 'Enter' && msgInput.value.trim() !== "") {
            socket.emit('sendMessage', {
                content: msgInput.value,
                channel: "general"
            });
            msgInput.value = "";
        }
    });

    // RECEIVE MESSAGE
    socket.on('newMessage', (msg) => {
        const msgHtml = `
            <div class="message">
                <img src="${msg.avatar}">
                <div class="msg-content">
                    <b>${msg.user}</b> <span style="font-size: 12px; color: var(--text-muted);">${msg.timestamp}</span>
                    <p>${msg.content}</p>
                </div>
            </div>
        `;
        msgArea.innerHTML += msgHtml;
        msgArea.scrollTop = msgArea.scrollHeight;
    });

    // UPDATE MEMBER LIST
    socket.on('presenceUpdate', (users) => {
        document.getElementById('user-count').innerText = users.length;
        document.getElementById('member-area').innerHTML = users.map(u => `
            <div class="user-row">
                <div style="position: relative;">
                    <img src="${u.avatar}" style="width: 32px; border-radius: 50%;">
                    <div class="status-dot" style="position: absolute; bottom: 0; right: 0;"></div>
                </div>
                <span>${u.name}</span>
            </div>
        `).join('');
    });
</script>

</body>
</html>
