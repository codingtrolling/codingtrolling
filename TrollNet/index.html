<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TrollNET | Advanced Simulator</title>
    
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- CSS DESIGN SYSTEM --- */
        :root {
            --bg: #050505;
            --nav: #121212;
            --card: #1a1a1a;
            --primary: #FF4500;
            --accent: #00FF41;
            --text: #ffffff;
            --border: #2a2a2a;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding-bottom: 70px;
        }

        /* Fixed Top Nav */
        header {
            background: var(--nav);
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            border-bottom: 2px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .search-bar {
            background: #222;
            border-radius: 20px;
            padding: 5px 15px;
            display: flex;
            align-items: center;
            width: 50%;
        }

        .search-bar input {
            background: transparent;
            border: none;
            color: white;
            padding: 5px;
            width: 100%;
            outline: none;
        }

        /* Stories Bar */
        .stories {
            display: flex;
            gap: 12px;
            padding: 15px;
            overflow-x: auto;
            background: var(--bg);
        }

        .story {
            min-width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .story img { width: 50px; height: 50px; border-radius: 50%; }

        /* Post Creation Window */
        .post-creator {
            background: var(--card);
            margin: 10px;
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--border);
        }

        textarea {
            width: 100%;
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            resize: none;
            outline: none;
            margin-bottom: 10px;
        }

        .preview-box {
            width: 100%;
            max-height: 250px;
            border-radius: 8px;
            display: none;
            margin-bottom: 10px;
            object-fit: cover;
        }

        .tool-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid var(--border);
            padding-top: 10px;
        }

        .file-label { color: var(--accent); font-size: 20px; cursor: pointer; }

        .btn-post {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
        }

        /* Posts Feed */
        .feed { padding: 10px; }

        .post-card {
            background: var(--card);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .user-block { display: flex; gap: 10px; align-items: center; }
        .user-block img { width: 40px; height: 40px; border-radius: 50%; }
        .user-name { font-weight: bold; font-size: 14px; }

        .sub-btn {
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 11px;
            text-transform: uppercase;
        }

        .sub-btn.active { background: var(--primary); color: white; }

        .post-content { font-size: 15px; line-height: 1.4; margin-bottom: 10px; }

        .post-img { width: 100%; border-radius: 10px; margin-bottom: 10px; }

        /* Actions Bar */
        .actions {
            display: flex;
            justify-content: space-around;
            border-top: 1px solid var(--border);
            padding-top: 10px;
        }

        .act { display: flex; align-items: center; gap: 5px; color: #888; font-size: 13px; cursor: pointer; }
        .act.liked { color: var(--primary); }

        /* Notification */
        #notify {
            position: fixed;
            top: 70px;
            right: 10px;
            background: var(--primary);
            padding: 10px 20px;
            border-radius: 8px;
            display: none;
            z-index: 10000;
        }
    </style>
</head>
<body>

    <div id="notify">Notification!</div>

    <header>
        <div style="color: var(--primary); font-weight: 900; font-size: 20px;">TrollNET</div>
        <div class="search-bar">
            <i class="fa fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search..." oninput="searchPosts()">
        </div>
        <div id="profileBtn">
            <img id="userImg" src="" style="width: 35px; border-radius: 50%; display: none;">
        </div>
    </header>

    <div class="stories" id="storyList">
        <div class="story"><div style="font-size: 30px;">+</div></div>
    </div>

    <div class="post-creator">
        <textarea id="postText" placeholder="Start a controversy..."></textarea>
        <img id="mediaPreview" class="preview-box">
        <div class="tool-row">
            <label for="fileUp" class="file-label"><i class="fa fa-camera"></i></label>
            <input type="file" id="fileUp" hidden accept="image/*,video/*" onchange="handleFile(event)">
            <button class="btn-post" onclick="createPost()">POST</button>
        </div>
    </div>

    <div class="feed" id="mainFeed">
        </div>

    <script>
        /* --- JAVASCRIPT LOGIC --- */

        const socket = io("https://suscraft-backend-production.up.railway.app");
        let user = null;
        let posts = [];
        let subs = new Set();

        // 1. SIMULATED LOGIN
        window.onload = () => {
            let saved = localStorage.getItem('trollUser');
            if (saved) {
                user = JSON.parse(saved);
            } else {
                let name = prompt("Enter your Troll Name:");
                user = {
                    id: "TR_" + Math.floor(Math.random() * 9999),
                    name: name || "Troll_" + Math.floor(Math.random() * 100),
                    pic: "https://api.dicebear.com/7.x/pixel-art/svg?seed=" + (name || "anon")
                };
                localStorage.setItem('trollUser', JSON.stringify(user));
            }
            document.getElementById('userImg').src = user.pic;
            document.getElementById('userImg').style.display = 'block';
            toast("Logon Successful as " + user.name);
        };

        // 2. FILE HANDLING (20MB Limit)
        let mediaData = null;
        function handleFile(e) {
            const file = e.target.files[0];
            if (file.size > 20 * 1024 * 1024) {
                alert("File too big! (Max 20MB)");
                return;
            }
            const reader = new FileReader();
            reader.onload = () => {
                mediaData = reader.result;
                const prev = document.getElementById('mediaPreview');
                prev.src = mediaData;
                prev.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        // 3. CREATE POST
        function createPost() {
            const txt = document.getElementById('postText').value;
            if (!txt && !mediaData) return;

            const newPost = {
                id: Date.now(),
                uid: user.id,
                uName: user.name,
                uPic: user.pic,
                content: txt,
                media: mediaData,
                likes: 0,
                likedBy: []
            };

            // Send to Railway
            socket.emit('newTrollPost', newPost);

            // Instant feedback for simulator feel
            document.getElementById('postText').value = "";
            document.getElementById('mediaPreview').style.display = 'none';
            mediaData = null;
            toast("Post Published!");
        }

        // 4. REAL-TIME RECEIVE
        socket.on('feedUpdate', (data) => {
            posts = data;
            render(posts);
        });

        // 5. RENDER SYSTEM
        function render(dataList) {
            const feed = document.getElementById('mainFeed');
            feed.innerHTML = "";
            dataList.forEach(p => {
                const isSub = subs.has(p.uid);
                const isLiked = p.likedBy?.includes(user.id);
                
                feed.innerHTML += `
                    <div class="post-card">
                        <div class="post-header">
                            <div class="user-block">
                                <img src="${p.uPic}">
                                <div class="user-name">${p.uName}</div>
                            </div>
                            <div class="sub-btn ${isSub ? 'active' : ''}" onclick="toggleSub('${p.uid}')">
                                ${isSub ? 'Unsubscribe' : 'Subscribe'}
                            </div>
                        </div>
                        <div class="post-content">${p.content}</div>
                        ${p.media ? `<img src="${p.media}" class="post-img">` : ''}
                        <div class="actions">
                            <div class="act ${isLiked ? 'liked' : ''}" onclick="like(${p.id})">
                                <i class="fa fa-heart"></i> ${p.likes}
                            </div>
                            <div class="act"><i class="fa fa-comment"></i> Comment</div>
                            <div class="act" onclick="share(${p.id})"><i class="fa fa-share"></i> Share</div>
                            <div class="act" style="color:red" onclick="report('${p.uName}')"><i class="fa fa-flag"></i></div>
                        </div>
                    </div>
                `;
            });
        }

        // 6. ACTION FUNCTIONS
        function toggleSub(uid) {
            if (subs.has(uid)) subs.delete(uid);
            else subs.add(uid);
            render(posts);
            toast("Subscription Updated");
        }

        function like(pid) {
            socket.emit('likePost', { pid: pid, uid: user.id });
            toast("You liked a post");
        }

        function share(pid) {
            navigator.clipboard.writeText("https://trollnet-simulator.com/p/" + pid);
            toast("Link Copied!");
        }

        function report(name) {
            let reason = prompt("Report " + name + " for:");
            if(reason) {
                socket.emit('reportSubmit', { violator: name, reason: reason, email: 'rabi65171@gmail.com' });
                alert("Report sent to rabi65171@gmail.com. User will be investigated for ban.");
            }
        }

        function searchPosts() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const filtered = posts.filter(p => p.content.toLowerCase().includes(q) || p.uName.toLowerCase().includes(q));
            render(filtered);
        }

        function toast(msg) {
            const box = document.getElementById('notify');
            box.innerText = msg;
            box.style.display = 'block';
            setTimeout(() => { box.style.display = 'none'; }, 2000);
        }
    </script>
</body>
</html>
